import{r as a,j as s}from"./index-BTxCUwbS.js";import{A as Y,a as K,b as q,S as N,T as k,C as Q,c as B,I as V,R as X,d as U,e as Z,B as ee,f as te,g as se,P as ne,h as ae,i as re,j as oe,E as ie}from"./ExpenseTrendCard-DNXzQBeV.js";import{S as le}from"./slideBar-BLoVtkfQ.js";import{U as ce,a as de,P as x,C as ue}from"./constants-B3xMendw.js";import{R as he,T as pe}from"./CategoricalChart-DD_Vt4QT.js";import{P as me,a as xe}from"./PieChart-Bjvo06eT.js";import{C as ge}from"./tooltipContext-jP36tpUq.js";import"./proxy-DP42388_.js";const ye="/assets/piechart-CSMeR5dl.png",W="http://localhost:5001/api",fe=async i=>{const r=await fetch(`${W}/expense-analysis`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok)throw new Error("Save failed");return r.json()},je=async i=>{const r=await fetch(`${W}/expense-analysis?userEmail=${i}`);if(r.status===204)return null;if(!r.ok)throw new Error("Fetch failed");return r.json()};function Te(){const[i,r]=a.useState("INR"),[o,v]=a.useState(0),[l,u]=a.useState([{category:"Food",amount:""}]),[S,M]=a.useState(""),[E,C]=a.useState(!1),[b,w]=a.useState(""),[A,I]=a.useState(!1),[g,R]=a.useState(!1),[T,z]=a.useState(window.innerWidth<600),y="test@gmail.com",f=o>0;a.useEffect(()=>{(async()=>{try{const t=await je(y);if(!t)return;r(t.currency),v(t.income),u(t.expenses.length>0?t.expenses.map(n=>({category:n.category,amount:n.amount})):[{category:"Food",amount:""}]),R(!0)}catch(t){console.error("Load failed",t)}})()},[y]),a.useEffect(()=>{const e=()=>{z(window.innerWidth<600)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const j=e=>{const t=ue[i];return t?`${t.symbol}${Number(e).toLocaleString(t.locale)}`:e},D=()=>u([...l,{category:"",amount:""}]),L=e=>u(l.filter((t,n)=>n!==e)),P=(e,t,n)=>{const O=[...l];O[e][t]=n,u(O)},c=l.reduce((e,t)=>{const n=Number(t.amount||0);return n&&(e[t.category]=(e[t.category]||0)+n),e},{}),h=Object.values(c).reduce((e,t)=>e+t,0),$=f?o-h:0,p=Math.max($,0),m=(o>0?[...Object.entries(c).map(([e,t])=>({name:e,value:t})),{name:"Savings",value:p}]:Object.entries(c).map(([e,t])=>({name:e,value:t}))).filter(e=>e.value>0),F=Object.entries(c).filter(([e])=>ce.includes(e)).reduce((e,[,t])=>e+t,0),d=o>0?Math.round(F/o*100):0,G=Math.min(d,100),_=d>70?"#ef4444":d>40?"#facc15":"#22c55e",H=async()=>{if(!f){alert("Please enter your income before submitting.");return}const e=l.filter(t=>t.category&&Number(t.amount)>0);if(e.length===0){alert("Please enter at least one valid expense.");return}I(!0);try{await fe({userEmail:y,currency:i,income:o,expenses:e,totalExpense:h,savings:p,unnecessaryPercent:d}),R(!0),localStorage.setItem("expenseAnalysisUpdated",Date.now())}catch(t){console.error(t)}finally{I(!1)}},J=async()=>{try{C(!0),w("");const e=await fetch("http://localhost:5001/api/ai-insights",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({income:o,expenses:l,currency:i})});if(!e.ok){const n=await e.text();throw new Error(n)}const t=await e.json();M(t.insights)}catch(e){w(e.message||"Unable to fetch AI insights.")}finally{C(!1)}};return s.jsxs(Y,{children:[s.jsx(le,{}),s.jsxs(K,{children:[s.jsxs(q,{children:[s.jsxs(N,{children:[s.jsx(k,{children:"Expense Categories"}),s.jsx(Q,{children:s.jsxs(B,{value:i,onChange:e=>r(e.target.value),children:[s.jsx("option",{value:"INR",children:"INR (â‚¹)"}),s.jsx("option",{value:"USD",children:"USD ($)"}),s.jsx("option",{value:"EUR",children:"EUR (â‚¬)"}),s.jsx("option",{value:"GBP",children:"GBP (Â£)"})]})}),s.jsxs(V,{children:[l.map((e,t)=>s.jsxs(X,{children:[s.jsx(B,{value:e.category,onChange:n=>P(t,"category",n.target.value),children:de.map(n=>s.jsx("option",{value:n,children:n},n))}),s.jsx(U,{type:"number",placeholder:"Amount",value:e.amount,onChange:n=>P(t,"amount",n.target.value)}),l.length>1&&s.jsx(Z,{onClick:()=>L(t),children:"âœ•"})]},t)),s.jsx(U,{type:"number",placeholder:"Monthly Income",value:o||"",onChange:e=>v(Number(e.target.value))})]}),s.jsxs(ee,{children:[s.jsx(te,{onClick:D,children:"+ Add Category"}),s.jsx(se,{onClick:H,disabled:A||h===0,children:A?"Submitting...":"Submit"})]})]}),s.jsxs(N,{children:[s.jsx(k,{children:"Analysis"}),g&&m.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{width:"100%",height:300},children:s.jsx(he,{width:"100%",height:"100%",children:s.jsxs(me,{children:[s.jsx(xe,{data:m,dataKey:"value",cx:"50%",cy:"50%",innerRadius:T?45:60,outerRadius:T?90:110,paddingAngle:4,label:({percent:e})=>`${(e*100).toFixed(0)}%`,children:m.map((e,t)=>s.jsx(ge,{fill:x[t%x.length]},t))}),s.jsx(pe,{formatter:(e,t)=>[j(e),t]})]})})}),s.jsx("div",{style:{marginTop:12},children:g&&m.map((e,t)=>s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14,marginBottom:6},children:[s.jsx("span",{style:{color:x[t%x.length]},children:e.name}),s.jsx("span",{children:j(e.value)})]},e.name))}),g&&f&&s.jsxs("p",{style:{marginTop:10,fontWeight:600},children:["ðŸ’° Savings: ",j(p)," (",(p/o*100).toFixed(0),"%)"]})]}):s.jsx(ne,{children:s.jsx(ae,{src:ye,alt:"Expense analysis preview"})})]})]}),s.jsxs(re,{children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"24px"},children:s.jsx(oe,{onClick:J,disabled:E||h===0,children:E?"Analyzing...":"Ask AI to Optimize Expenses"})}),b&&s.jsx("p",{style:{marginTop:10,color:"#f87171"},children:b}),S&&s.jsx("div",{style:{marginTop:14,padding:"14px 16px",borderRadius:12,background:"rgba(255,255,255,0.08)",fontSize:14,lineHeight:1.6},children:S})]}),s.jsx(ie,{maxwidth:!0,withMargin:!0,unnecessaryPercent:d,riskColor:_,riskBarWidth:G,categoryTotals:c})]})]})}export{Te as default};
